<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/timeshare.css" type="text/css">
  <title>Time-Share</title>
</head>

<body>

  <div class="container">
    <div class="center">

      <h1 id="timestamp" class="d-flex justify-content-center">Loading...
      </h1>
      <div class="d-flex justify-content-center">

        <button id=" pauseTimer" class="btn btn-secondary btnSpace" onclick="pauseTimer()">Pause</button>
        <button id="playTimer" class="btn btn-secondary btnSpace" onclick="playTimer()">Play</button>
        <button id="shareTimer" class="btn btn-success btnSpace" onclick="shareTimer()">Share Timer (Clipboard)</button>
      </div>
    </div>
    <!-- <button id="resetTimer" onclick="resetTimer()">Reset</button> -->
  </div>
  <div id="snackbar">Copied Link to Clipboard</div>
  <script src="/socket.io/socket.io.js"></script>

  <script>
    const socket = io();
  </script>

  <script>
    // const pauseTimer = document.getElementById("pauseTimer");
    // const playTimer = document.getElementById("playTimer");
    // const resetTimer = document.getElementById("resetTimer");
    // Listen for messages from server
    // socket.on("connect", (msg) => { 
    //   // clearTimeout(timeout);
    // });
    const timeout = setTimeout(() => { window.location.reload() }, 5000)
    socket.on("message", (msg) => {
      console.log("Message from server ", msg);
    });
    // Listen for timestamps from server
    socket.on("timestamp", (msg) => {
      clearTimeout(timeout);
      document.getElementById("timestamp").innerHTML = msg.timestamp;
      console.log("TimeStamp:", msg)
      if (msg.expired === true) document.getElementById("timestamp").innerHTML = '00:00:00';
    });

    // parse url to get id and put in var
    const userId = document.location.pathname.split("/").pop()
    const requestOrigin = window.location.host
    const pauseTimer = () => {
      socket.emit("pausetimer", { userId, requestOrigin });
      // console.log("requestOrigin", requestOrigin)
      // console.log(`Command: pausetimer`);
    };
    const playTimer = () => {
      socket.emit("playtimer", { userId, requestOrigin });
      // console.log(`Command: playtimer`);
    };

    // const resetTimer = () => {
    //   socket.emit("resettimer", `Command: resettimer`);
    //   console.log(`Command:resettimer`);
    // };

  </script>
  <!-- <script src="socketClient.js"></script> -->

  <script>
    const shareTimer = () => {
      const ShareUrl = window.location.href
      navigator.clipboard.writeText(ShareUrl)
      console.log("Copied to Clipboard", ShareUrl)


      // Get the snackbar DIV
      var x = document.getElementById("snackbar");

      // Add the "show" class to DIV
      x.className = "show";

      // After 3 seconds, remove the show class from DIV
      setTimeout(function () { x.className = x.className.replace("show", ""); }, 3000);
    };
  </script>
</body>

</html>